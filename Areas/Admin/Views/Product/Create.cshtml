@model MyProject.Models.Shared.Product

@{
    ViewData["Title"] = "Thêm sản phẩm mới";
}

<div class="mb-6">
    <a asp-action="Index" class="inline-flex items-center gap-2 text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
        <i class="fas fa-arrow-left"></i>
        <span>Quay lại danh sách</span>
    </a>
</div>

<div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
    <!-- Main Form -->
    <div class="lg:col-span-2">
    <div class="p-6 bg-white border border-gray-200 rounded-lg dark:bg-gray-900 dark:border-gray-800">
        <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Thêm sản phẩm mới</h1>
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Điền thông tin để tạo sản phẩm mới</p>
        </div>

        <form asp-action="Create" method="post" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="p-4 mb-6 text-red-800 bg-red-100 border border-red-200 rounded-lg dark:bg-red-900/20 dark:border-red-800 dark:text-red-400"></div>

            <div class="space-y-6">
                <!-- Product Name -->
                <div>
                    <label asp-for="ProductName" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                        Tên sản phẩm <span class="text-red-500">*</span>
                    </label>
                    <input asp-for="ProductName" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"
                           placeholder="Nhập tên sản phẩm">
                    <span asp-validation-for="ProductName" class="mt-1 text-sm text-red-600"></span>
                </div>

                <!-- Description -->
                <div>
                    <label asp-for="Description" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                        Mô tả
                    </label>
                    <textarea asp-for="Description" rows="4"
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"
                              placeholder="Mô tả chi tiết về sản phẩm"></textarea>
                    <span asp-validation-for="Description" class="mt-1 text-sm text-red-600"></span>
                </div>

                <!-- Product Images Upload -->
                <div>
                    <label class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                        Hình ảnh sản phẩm
                    </label>
                    <div class="relative">
                        <input type="file" 
                               name="productImages" 
                               id="productImages"
                               multiple
                               accept="image/*"
                               class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-800 dark:border-gray-700 dark:placeholder-gray-400
                                      file:mr-4 file:py-2 file:px-4
                                      file:rounded-l-lg file:border-0
                                      file:text-sm file:font-semibold
                                      file:bg-brand-50 file:text-brand-700
                                      hover:file:bg-brand-100
                                      dark:file:bg-brand-900/30 dark:file:text-brand-400">
                        <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                            <i class="fas fa-info-circle"></i>
                            PNG, JPG, GIF, WEBP (MAX. 10MB mỗi ảnh). Ảnh đầu tiên sẽ là ảnh chính.
                        </p>
                    </div>
                    <!-- Preview container -->
                    <div id="imagePreviewContainer" class="grid grid-cols-2 gap-4 mt-4 md:grid-cols-3 lg:grid-cols-4"></div>
                </div>

                <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                    <!-- Category -->
                    <div>
                        <label asp-for="CategoryId" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            Danh mục <span class="text-red-500">*</span>
                        </label>
                        <select asp-for="CategoryId" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white">
                            <option value="">-- Chọn danh mục --</option>
                            @foreach (var category in ViewBag.Categories as List<MyProject.Models.Shared.Categories>)
                            {
                                <option value="@category.CategoryId">@category.CategoryName</option>
                            }
                        </select>
                        <span asp-validation-for="CategoryId" class="mt-1 text-sm text-red-600"></span>
                    </div>

                    <!-- Supplier -->
                    <div>
                        <label asp-for="SupplierId" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            Nhà cung cấp <span class="text-red-500">*</span>
                        </label>
                        <select asp-for="SupplierId" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white">
                            <option value="">-- Chọn nhà cung cấp --</option>
                            @foreach (var supplier in ViewBag.Suppliers as List<MyProject.Models.Shared.Supplier>)
                            {
                                <option value="@supplier.SupplierId">@supplier.SupplierName</option>
                            }
                        </select>
                        <span asp-validation-for="SupplierId" class="mt-1 text-sm text-red-600"></span>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="p-4 border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-900/20">
                    <div class="flex items-start gap-3">
                        <i class="mt-1 text-blue-600 fas fa-info-circle dark:text-blue-400"></i>
                        <div class="text-sm text-blue-800 dark:text-blue-300">
                            <p class="font-medium mb-1">Lưu ý về tồn kho:</p>
                            <p>Số lượng tồn kho sẽ được tính tự động từ các biến thể sản phẩm. Sau khi tạo sản phẩm, hãy thêm các biến thể để quản lý tồn kho chi tiết.</p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="submit" 
                            class="flex items-center gap-2 px-6 py-2 text-white transition-colors rounded-lg bg-brand-600 hover:bg-brand-700">
                        <i class="fas fa-save"></i>
                        <span>Lưu sản phẩm</span>
                    </button>
                    <a asp-action="Index" 
                       class="flex items-center gap-2 px-6 py-2 text-gray-700 transition-colors bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700">
                        <i class="fas fa-times"></i>
                        <span>Hủy</span>
                    </a>
                </div>
            </div>
        </form>
    </div>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1">
        <div class="sticky top-6 space-y-4">
            <!-- Help Card -->
            <div class="p-6 bg-white border border-gray-200 rounded-lg dark:bg-gray-900 dark:border-gray-800">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-green-100 dark:bg-green-900/30">
                        <i class="text-green-600 fas fa-lightbulb dark:text-green-400"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 dark:text-white">Hướng dẫn</h3>
                </div>
                <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-400">
                    <li class="flex items-start gap-2">
                        <i class="mt-1 text-green-500 fas fa-check-circle"></i>
                        <span>Điền đầy đủ thông tin sản phẩm</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="mt-1 text-green-500 fas fa-check-circle"></i>
                        <span>Chọn đúng danh mục và nhà cung cấp</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="mt-1 text-green-500 fas fa-check-circle"></i>
                        <span>Mô tả chi tiết giúp khách hàng hiểu rõ hơn</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="mt-1 text-yellow-500 fas fa-exclamation-circle"></i>
                        <span>Sau khi tạo, nhớ thêm biến thể sản phẩm</span>
                    </li>
                </ul>
            </div>

            <!-- Quick Stats -->
            <div class="p-6 bg-gradient-to-br from-green-500 to-green-600 rounded-lg text-white">
                <div class="flex items-center gap-3 mb-3">
                    <i class="text-2xl fas fa-box-open"></i>
                    <div>
                        <p class="text-sm opacity-90">Quản lý sản phẩm</p>
                        <p class="text-lg font-bold">Dễ dàng</p>
                    </div>
                </div>
                <p class="text-sm opacity-90">Thêm biến thể (size, màu sắc) để quản lý tồn kho chi tiết sau khi tạo sản phẩm</p>
            </div>

            <!-- Next Steps -->
            <div class="p-6 bg-white border border-gray-200 rounded-lg dark:bg-gray-900 dark:border-gray-800">
                <h4 class="mb-3 font-semibold text-gray-900 dark:text-white">Bước tiếp theo</h4>
                <ol class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                    <li class="flex items-start gap-2">
                        <span class="flex items-center justify-center w-5 h-5 text-xs font-bold text-white rounded-full bg-brand-500">1</span>
                        <span>Tạo sản phẩm</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="flex items-center justify-center w-5 h-5 text-xs font-bold text-white rounded-full bg-brand-500">2</span>
                        <span>Thêm biến thể</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="flex items-center justify-center w-5 h-5 text-xs font-bold text-white rounded-full bg-brand-500">3</span>
                        <span>Cập nhật tồn kho</span>
                    </li>
                </ol>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ModernValidationScripts");}
    
    <script>
        // Image preview functionality
        document.getElementById('productImages').addEventListener('change', function(e) {
            const previewContainer = document.getElementById('imagePreviewContainer');
            previewContainer.innerHTML = ''; // Clear previous previews
            
            const files = Array.from(e.target.files);
            
            files.forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const div = document.createElement('div');
                        div.className = 'relative group';
                        div.innerHTML = `
                            <img src="${e.target.result}" 
                                 class="object-cover w-full h-32 border-2 border-gray-200 rounded-lg dark:border-gray-700" 
                                 alt="Preview ${index + 1}">
                            <div class="absolute top-0 left-0 w-full h-full transition-opacity bg-black rounded-lg opacity-0 bg-opacity-40 group-hover:opacity-100">
                                <div class="flex items-center justify-center h-full">
                                    ${index === 0 ? '<span class="px-2 py-1 text-xs font-semibold text-white bg-green-500 rounded">Ảnh chính</span>' : ''}
                                </div>
                            </div>
                        `;
                        previewContainer.appendChild(div);
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            if (files.length > 0) {
                const info = document.createElement('div');
                info.className = 'col-span-full mt-2 text-sm text-gray-600 dark:text-gray-400';
                info.innerHTML = `<i class="fas fa-check-circle text-green-500"></i> Đã chọn ${files.length} ảnh`;
                previewContainer.appendChild(info);
            }
        });
    </script>
}
